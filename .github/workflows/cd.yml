 name: CD

on:
  push:
    branches: [main]

jobs:
  train:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      
      - run: pip install pandas numpy lightgbm joblib
      
      - run: |
          python -c "
import pandas as pd
import numpy as np
import lightgbm as lgb
import joblib
from datetime import datetime

# Données
cities = ['SEATTLE','BELLEVUE','REDMOND','KIRKLAND','RENTON']
df = pd.DataFrame({
    'sale_price': np.random.randint(300000, 1500000, 500),
    'city': np.random.choice(cities, 500),
    'sqft': np.random.randint(1000, 3500, 500),
    'year_built': np.random.randint(1970, 2020, 500)
})

# Features
df['age'] = 2024 - df['year_built']
df['log_sqft'] = np.log1p(df['sqft'])

# Modèle
X = df[['log_sqft', 'age']]
y = np.log1p(df['sale_price'])
model = lgb.LGBMRegressor(n_estimators=50)
model.fit(X, y)

# Sauvegarde
timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
joblib.dump(model, f'model_{timestamp}.joblib')

# Prédictions
df['pred'] = np.expm1(model.predict(X))
df.to_csv(f'predictions_{timestamp}.csv', index=False)

print('✅ Modèle entraîné et prédictions sauvegardées')
          "
      
      - uses: actions/upload-artifact@v4
        with:
          name: model-files
          path: |
            *.joblib
            *.csv
